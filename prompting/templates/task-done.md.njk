{#
variables:
  taskId: string        # Task ID (T001)
  epicId: string|null   # Parent epic ID
  mode: worktree|inline # Execution mode
  sandbox: boolean      # Running in sandbox
  role: skill|agent     # Actor role
  taskBody: string|null # Task deliverables (optional)
#}
{% if role == 'skill' %}
# Mark Done: {{ taskId }}

{% if epicId %}Epic: {{ epicId }}{% endif %}

---

## Your Role

You are the **skill** validating task completion.

- ✅ Verify deliverables are met
- ✅ Check logs exist (≥2 entries, at least 1 TIP)
- ✅ Update status
- ❌ DO NOT skip validation

---

## Validation Checklist

{% if sandbox %}
```json
{ "command": "task:show {{ taskId }}" }
{ "command": "task:log {{ taskId }} --list" }
```
{% else %}
```bash
rudder task:show {{ taskId }}
rudder task:log {{ taskId }} --list
```
{% endif %}

### Required:
- [ ] All deliverables completed
- [ ] At least 2 log entries
- [ ] At least 1 TIP log entry
- [ ] No unresolved --error logs

---

## Mark Complete

{% if sandbox %}
```json
{ "command": "task:update {{ taskId }} --status Done" }
{ "command": "memory:sync" }
```
{% else %}
```bash
rudder task:update {{ taskId }} --status Done
rudder memory:sync
```
{% endif %}

---

## If Incomplete

Keep in progress and investigate:
{% if sandbox %}
```json
{ "command": "agent:log {{ taskId }}" }
```
{% else %}
```bash
rudder agent:log {{ taskId }}
```
{% endif %}

{% else %}{# role == 'agent' #}
# Agent: Complete {{ taskId }}

---

## Before Exiting

1. **Verify deliverables** are complete
2. **Log at least one insight**:
{% if sandbox %}
```json
{ "command": "task:log {{ taskId }} \"Notable insight\" --tip" }
```
{% else %}
```bash
rudder task:log {{ taskId }} "Notable insight" --tip
```
{% endif %}

3. **Exit normally** (exit 0)

---

## Git

{% if mode == 'worktree' %}
**Commit before exiting**:
```bash
git add -A
git commit -m "feat({{ taskId }}): <description>"
```
{% else %}
**No commit** - coordinator handles git.
{% endif %}

{% endif %}{# /role #}
{% if taskBody %}
---

# Task Deliverables

{{ taskBody }}
{% endif %}
